#!/bin/sh
# "configure" file for medm, do 2 things:
# - Find packages to be installed
# - Generate a config.mak (if needed)


# Find out the Linux distribution
# Ideas stolen from here:
#   https://github.com/jeonghanlee/pkg_automation/blob/master/pkg_automation.bash
if [ -x /usr/bin/lsb_release ] ; then
  dist_id=$(lsb_release -is)
  dist_cn=$(lsb_release -cs)
  dist_rs=$(lsb_release -rs)
  tmpdist=$dist_id${dist_cn}${dist_rs}
elif [ -r /etc/os-release ] ; then
  eval $(grep "^ID=" /etc/os-release)
  eval $(grep "^VERSION_ID=" /etc/os-release)
  tmpdist=$ID$VERSION_ID
else
  tmpdist=Unknown
fi

case "$tmpdist" in
  centos7)
    linuxdistro=centos7
    ;;
  [dD]ebian*8*)
    linuxdistro=Debian8
   ;;
  Debian*9*)
    linuxdistro=Debian9
    ;;
  Raspbian*8*)
    linuxdistro=Raspbian8
    ;;
  Raspbian*9*)
    linuxdistro=Raspbian9
    ;;
  *)
    echo >&2 "Unsupported platform"
    exit 1
    ;;
esac


echo linuxdistro = $linuxdistro

case "$linuxdistro" in
  centos7)
    if ! test -e /usr/include/Xm/XmP.h; then
      cmd="sudo yum install -y libXt-devel libXp-devel libXmu-devel libXpm-devel lesstif-devel"
      echo $cmd
      eval $cmd
    fi
    cmd="echo USR_LIBS_Linux = Xm Xt Xmu X11 Xext >medm/config.mak"
    echo $cmd
    eval $cmd
    ;;
  Debian[89])
    if ! test -e /usr/include/Xm/XmP.h; then
      cmd="sudo apt-get install -y libmotif-dev x11proto-print-dev xfonts-100dpi libxmu-dev libxpm-dev"
      echo $cmd
      eval $cmd
    fi
    cmd="echo USR_LIBS_Linux = Xm Xt Xmu X11 Xext >medm/config.mak"
    echo $cmd
    eval $cmd
    ;;
  *)
esac






# Install for Raspbian
#ifeq ($(shell expr "$(LINUX_DISTRO)" : 'Raspbian[89]'),9)
#build: /usr/include/Xm/XmP.h

#/usr/include/Xm/XmP.h:
#       sudo apt-get install -y x11proto-print-dev libmotif-dev xfonts-100dpi libxp-dev libxmu-dev libxpm-dev
#endif
